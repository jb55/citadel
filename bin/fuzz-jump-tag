#!/usr/bin/env bash

set -eou pipefail

TAGS=tags

if [ ! -f tags ]; then
	TAGS="$(git rev-parse --show-toplevel)/tags"

	if [ ! -f "$TAGS" ]; then
		printf "no tags found\n" >&2
		exit 1
	fi
fi

cutt() {
	cut -d $'\t' --output-delimiter=$'\t' "$@"
}

res=$(grep -v '^!_TAG' "$TAGS" | fzf)
file=$(<<<"$res" cutt -f2)
search=$(<<<"$res" cutt -f3- | sed -E -n 's,^([^"]+).*,\1,p')

printf "vim '%s' -c %q -c :noh\n" "$file" "$search"
