#!/usr/bin/env bash

function runner() {
  local prefix
  local res
  local get_cmd
  local fhist
  local cmd
  if [ -n "$1" ]; then
    prefix="$1"
    shift
  fi
  res=$($FUZZER +i --select-1 --exit-0 -q ^$prefix < $HOME/dotfiles/commands) &&
  get_cmd=$(cutt -f3 <<<"$res") || return
  get_cmd="$get_cmd $@"
  fhist="$HOME/.fuzzhist"
  touch "$fhist"
  cmd="$(eval $get_cmd)"
  if [ -n "$cmd" ]; then
    echo "$cmd" >> "$fhist"
    eval $cmd
  fi
}

runner "$@"
