#!/usr/bin/env bash

dir=$(dirname "$1")
base=$(basename "$1")

if [ "$base" == "" ]; then
	exit 3
fi

export LESSHISTFILE="$dir/.$base.hst"
touch $LESSHISTFILE || :
printf "lesshistfile '%s'\n" "$LESSHISTFILE" >&2

# use a fallback dir if it's not writable
if [ ! -w "$LESSHISTFILE" ]
then
	printf "using lesshistfile fallback\n" >&2
    dir="$HOME/var/marks"
    mkdir -p "$dir"
    export LESSHISTFILE="$dir/.$base.hst"
fi

# export LESS="-cix8JRM --save-marks"
less "+''" --save-marks "$@"
